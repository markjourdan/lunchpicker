@model LunchPicker.Web.Models.Home.CrunchModel

@{
    ViewBag.Title = "Lunch Picker";
}
<div style="text-align: center; width: 100%; margin-top: 100px;">
    @foreach (var clique in Model.Cliques)
    {
        <div style="margin-top: 10px;">
            <label for="place-@clique.CliqueId" class="lblPick">today's spot for @clique.Name</label>
            <input name="place-@clique.CliqueId" type="text" readonly="readonly" id="place-@clique.CliqueId" class="place">
            <div id="ResturantLink-@clique.CliqueId" class="ResturantLink"></div>
            <div style="clear:both;">
                <input type="submit" name="btnPick" value="crunch!" cliqueId="@clique.CliqueId" id="btnPick-@clique.CliqueId" class="k-primary k-button k-button-pick" role="button">
            </div>
        </div>
    }
</div>

<script src="../../Scripts/jrumble.min.js"></script>    
<script type="text/javascript">
    $(document).ready(function () {
        $('.k-button-pick').each(function () {
            var cliqueId = $(this).attr('cliqueId');
            AddButtonPick($(this), $('#place-' + cliqueId), $('#ResturantLink-' + cliqueId), cliqueId);
        });
    });

    function AddButtonPick(control, textbox, link, cliqueId) {
        control.click(function (e) {
            e.preventDefault();
            /* Disable the button */
            control.attr('disabled', 'disabled');
            control.val('No Second Chance!');

            /* Begin shaking the textbox */
            textbox.jrumble({
                rumbleEvent: 'mousedown',
            });
            textbox.trigger('mousedown');

            /* call service to get a restaurant pick and return it to stop shaking the textbox */
            $.ajax({
                url: '@Url.Action("GetRestaurantPick")',
                contentType: "application/json; charset=utf-8",
                data: { cliqueId : cliqueId},
                dataType: "json",
                cache: false,
                success: function (data) {                        
                    window.setTimeout(function () {
                        textbox.val(data.Name).trigger('mouseup');
                        textbox.unbind('mousedown');

                        if (data.RestaurantId != 0) {
                            link.append("<a href='Clique/" + data.CliqueId + "/Restaurant/About/" + data.RestaurantId + "'>view more information on " + data.Name + "</a>");
                        }
                    }, 1000);
                },
                error: function (xmlHttpRequest, textStatus, errorThrown) {
                    alert(textStatus);
                    console.log(errorThrown);
                    console.log(xmlHttpRequest);
                }
            });
        });
    }

</script>

<style type="text/css">
    .lblPick
    {
        display: inline-block;
        min-width: 200px;
        font-size:1em;
        font-weight:bold;
        color:#999999;
    }
    .place
    {
        font-size:2.5em;
        border:solid 3px #999999;
        color: #5EB2D4;
        padding:2px;
    }
    .ResturantLink {
        padding: 5px 0;
    }
    .ResturantLink a 
    {
        color: #999999;
        font-weight:bold;
        text-decoration:none;
        border-bottom:solid 1px #5EB2D4;
    }
    .ResturantLink a:hover 
    {
        color:#5EB2D4;
        border-bottom:solid 1px #999999;
    }
</style>
